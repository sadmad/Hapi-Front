"use client"
var le=Object.create;var M=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var y=(e,t)=>M(e,"name",{value:t,configurable:!0});var Fe=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})},L=(e,t,s,V)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of pe(t))!me.call(e,n)&&n!==s&&M(e,n,{get:()=>t[n],enumerable:!(V=ue(t,n))||V.enumerable});return e};var K=(e,t,s)=>(s=e!=null?le(ce(e)):{},L(t||!e||!e.__esModule?M(s,"default",{value:e,enumerable:!0}):s,e)),Re=e=>L(M({},"__esModule",{value:!0}),e);var ye={};Fe(ye,{useForm:()=>C,useModalForm:()=>oe,useStepsForm:()=>ae});module.exports=Re(ye);var Y=require("react"),ee=K(require("lodash/get")),te=K(require("lodash/has")),re=require("react-hook-form"),E=require("@refinedev/core");var C=y(({refineCoreProps:e,warnWhenUnsavedChanges:t,disableServerSideValidation:s=!1,...V}={})=>{let{options:n}=(0,E.useRefineContext)(),v=(n==null?void 0:n.disableServerSideValidation)||s,H=(0,E.useTranslate)(),{warnWhenUnsavedChanges:g,setWarnWhen:D}=(0,E.useWarnAboutChange)(),B=t??g,d=(0,re.useForm)({...V}),{watch:R,setValue:x,getValues:p,handleSubmit:T,setError:b}=d,f=(0,E.useForm)({...e,onMutationError:(a,o,r)=>{var Q,k;if(v){(Q=e==null?void 0:e.onMutationError)==null||Q.call(e,a,o,r);return}let m=a==null?void 0:a.errors;for(let S in m){if(!Object.keys((0,E.flattenObjectKeys)(o)).includes(S))continue;let F=m[S],h="";Array.isArray(F)&&(h=F.join(" ")),typeof F=="string"&&(h=F),typeof F=="boolean"&&F&&(h="Field is not valid."),typeof F=="object"&&"key"in F&&(h=H(F.key,F.message)),b(S,{message:h})}(k=e==null?void 0:e.onMutationError)==null||k.call(e,a,o,r)}}),{query:c,onFinish:i,formLoading:U,onFinishAutoSave:A}=f;(0,Y.useEffect)(()=>{var r;let a=(r=c==null?void 0:c.data)==null?void 0:r.data;if(!a)return;Object.keys((0,E.flattenObjectKeys)(p())).forEach(m=>{let Q=(0,te.default)(a,m),k=(0,ee.default)(a,m);Q&&x(m,k)})},[c==null?void 0:c.data,x,p]),(0,Y.useEffect)(()=>{let a=R((o,{type:r})=>{r==="change"&&N(o)});return()=>a.unsubscribe()},[R]);let N=y(a=>{var o;if(B&&D(!0),e!=null&&e.autoSave){D(!1);let r=((o=e.autoSave)==null?void 0:o.onFinish)??(m=>m);return A(r(a)).catch(m=>m)}return a},"onValuesChange"),j=y((a,o)=>async r=>(D(!1),T(a,o)(r)),"handleSubmit");return{...d,handleSubmit:j,refineCore:f,saveButtonProps:{disabled:U,onClick:a=>{j(o=>i(o).catch(()=>{}),()=>!1)(a)}}}},"useForm");var P=require("react"),se=K(require("lodash/get"));var ae=y(({stepsProps:e,...t}={})=>{let{defaultStep:s=0,isBackValidate:V=!1}=e??{},[n,v]=(0,P.useState)(s),H=C({...t}),{trigger:g,getValues:D,setValue:B,formState:{dirtyFields:d},refineCore:{query:R}}=H;(0,P.useEffect)(()=>{var f;let T=(f=R==null?void 0:R.data)==null?void 0:f.data;if(!T)return;let b=Object.keys(D());console.log({dirtyFields:d,registeredFields:b,data:T}),Object.entries(T).forEach(([c,i])=>{let U=c;b.includes(U)&&((0,se.default)(d,U)||B(U,i))})},[R==null?void 0:R.data,n,B,D]);let x=y(T=>{let b=T;T<0&&(b=0),v(b)},"go");return{...H,steps:{currentStep:n,gotoStep:y(async T=>{if(T===n)return;if(T<n&&!V){x(T);return}await g()&&x(T)},"gotoStep")}}},"useStepsForm");var z=require("react"),u=require("@refinedev/core");var $=K(require("react"));var oe=y(({modalProps:e,refineCoreProps:t,syncWithLocation:s,...V}={})=>{var X,Z;let n=(0,u.useInvalidate)(),[v,H]=$.default.useState(!1),g=(0,u.useTranslate)(),{resource:D,action:B}=t??{},{resource:d,action:R,identifier:x}=(0,u.useResource)(D),p=(0,u.useParsed)(),T=(0,u.useGo)(),b=(0,u.useUserFriendlyName)(),f=B??R??"",c=!(typeof s=="object"&&(s==null?void 0:s.syncId)===!1),i=typeof s=="object"&&"key"in s?s.key:d&&f&&s?`modal-${x}-${f}`:void 0,{defaultVisible:U=!1,autoSubmitClose:A=!0,autoResetForm:N=!0}=e??{},j=C({refineCoreProps:{...t,meta:{...i?{[i]:void 0}:{},...t==null?void 0:t.meta}},...V}),{reset:J,refineCore:{onFinish:a,id:o,setId:r,autoSaveProps:m},saveButtonProps:Q,handleSubmit:k}=j,{visible:S,show:w,close:F}=(0,u.useModal)({defaultVisible:U});$.default.useEffect(()=>{var l,W,G,_;if(v===!1&&i){let O=(W=(l=p==null?void 0:p.params)==null?void 0:l[i])==null?void 0:W.open;if(typeof O=="boolean"?O&&w():typeof O=="string"&&O==="true"&&w(),c){let q=(_=(G=p==null?void 0:p.params)==null?void 0:G[i])==null?void 0:_.id;q&&(r==null||r(q))}H(!0)}},[i,p,c,r]),$.default.useEffect(()=>{var l;v===!0&&(S&&i?T({query:{[i]:{...(l=p==null?void 0:p.params)==null?void 0:l[i],open:!0,...c&&o&&{id:o}}},options:{keepQuery:!0},type:"replace"}):i&&!S&&T({query:{[i]:void 0},options:{keepQuery:!0},type:"replace"}))},[o,S,w,i,c]);let h=y(async l=>{await a(l),A&&F(),N&&J()},"submit"),{warnWhen:I,setWarnWhen:ne}=(0,u.useWarnAboutChange)(),de=(0,z.useCallback)(()=>{var l;if(m.status==="success"&&((l=t==null?void 0:t.autoSave)!=null&&l.invalidateOnClose)&&n({id:o,invalidates:t.invalidates||["list","many","detail"],dataProviderName:t.dataProviderName,resource:x}),I)if(window.confirm(g("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))ne(!1);else return;r==null||r(void 0),F()},[I,m.status]),Te=(0,z.useCallback)(l=>{typeof l<"u"&&(r==null||r(l)),(!(f==="edit"||f==="clone")||(typeof l<"u"||typeof o<"u"))&&w()},[o]),ie=g(`${x}.titles.${B}`,void 0,`${b(`${B} ${((X=d==null?void 0:d.meta)==null?void 0:X.label)??((Z=d==null?void 0:d.options)==null?void 0:Z.label)??(d==null?void 0:d.label)??x}`,"singular")}`);return{modal:{submit:h,close:de,show:Te,visible:S,title:ie},...j,saveButtonProps:{...Q,onClick:l=>k(h)(l)}}},"useModalForm");
//# sourceMappingURL=index.cjs.map