"use client"
var L=Object.defineProperty;var F=(t,a)=>L(t,"name",{value:a,configurable:!0});import{useEffect as Y}from"react";import ee from"lodash-es/get.js";import te from"lodash-es/has.js";import{useForm as re}from"react-hook-form";import{useForm as se,useWarnAboutChange as ae,useTranslate as oe,useRefineContext as ne,flattenObjectKeys as z}from"@refinedev/core";var C=F(({refineCoreProps:t,warnWhenUnsavedChanges:a,disableServerSideValidation:c=!1,...g}={})=>{let{options:R}=ne(),S=(R==null?void 0:R.disableServerSideValidation)||c,h=oe(),{warnWhenUnsavedChanges:U,setWarnWhen:b}=ae(),f=a??U,o=re({...g}),{watch:m,setValue:y,getValues:i,handleSubmit:n,setError:E}=o,x=se({...t,onMutationError:(r,s,e)=>{var v,H;if(S){(v=t==null?void 0:t.onMutationError)==null||v.call(t,r,s,e);return}let u=r==null?void 0:r.errors;for(let V in u){if(!Object.keys(z(s)).includes(V))continue;let p=u[V],D="";Array.isArray(p)&&(D=p.join(" ")),typeof p=="string"&&(D=p),typeof p=="boolean"&&p&&(D="Field is not valid."),typeof p=="object"&&"key"in p&&(D=h(p.key,p.message)),E(V,{message:D})}(H=t==null?void 0:t.onMutationError)==null||H.call(t,r,s,e)}}),{query:l,onFinish:d,formLoading:B,onFinishAutoSave:M}=x;Y(()=>{var e;let r=(e=l==null?void 0:l.data)==null?void 0:e.data;if(!r)return;Object.keys(z(i())).forEach(u=>{let v=te(r,u),H=ee(r,u);v&&y(u,H)})},[l==null?void 0:l.data,y,i]),Y(()=>{let r=m((s,{type:e})=>{e==="change"&&W(s)});return()=>r.unsubscribe()},[m]);let W=F(r=>{var s;if(f&&b(!0),t!=null&&t.autoSave){b(!1);let e=((s=t.autoSave)==null?void 0:s.onFinish)??(u=>u);return M(e(r)).catch(u=>u)}return r},"onValuesChange"),Q=F((r,s)=>async e=>(b(!1),n(r,s)(e)),"handleSubmit");return{...o,handleSubmit:Q,refineCore:x,saveButtonProps:{disabled:B,onClick:r=>{Q(s=>d(s).catch(()=>{}),()=>!1)(r)}}}},"useForm");import{useEffect as de,useState as Te}from"react";import ie from"lodash-es/get.js";var le=F(({stepsProps:t,...a}={})=>{let{defaultStep:c=0,isBackValidate:g=!1}=t??{},[R,S]=Te(c),h=C({...a}),{trigger:U,getValues:b,setValue:f,formState:{dirtyFields:o},refineCore:{query:m}}=h;de(()=>{var x;let n=(x=m==null?void 0:m.data)==null?void 0:x.data;if(!n)return;let E=Object.keys(b());console.log({dirtyFields:o,registeredFields:E,data:n}),Object.entries(n).forEach(([l,d])=>{let B=l;E.includes(B)&&(ie(o,B)||f(B,d))})},[m==null?void 0:m.data,R,f,b]);let y=F(n=>{let E=n;n<0&&(E=0),S(E)},"go");return{...h,steps:{currentStep:R,gotoStep:F(async n=>{if(n===R)return;if(n<R&&!g){y(n);return}await U()&&y(n)},"gotoStep")}}},"useStepsForm");import{useCallback as J}from"react";import{useGo as ue,useModal as pe,useParsed as ce,useResource as me,useUserFriendlyName as Fe,useTranslate as Re,useWarnAboutChange as ye,useInvalidate as Ee}from"@refinedev/core";import P from"react";var xe=F(({modalProps:t,refineCoreProps:a,syncWithLocation:c,...g}={})=>{var A,N;let R=Ee(),[S,h]=P.useState(!1),U=Re(),{resource:b,action:f}=a??{},{resource:o,action:m,identifier:y}=me(b),i=ce(),n=ue(),E=Fe(),x=f??m??"",l=!(typeof c=="object"&&(c==null?void 0:c.syncId)===!1),d=typeof c=="object"&&"key"in c?c.key:o&&x&&c?`modal-${y}-${x}`:void 0,{defaultVisible:B=!1,autoSubmitClose:M=!0,autoResetForm:W=!0}=t??{},Q=C({refineCoreProps:{...a,meta:{...d?{[d]:void 0}:{},...a==null?void 0:a.meta}},...g}),{reset:$,refineCore:{onFinish:r,id:s,setId:e,autoSaveProps:u},saveButtonProps:v,handleSubmit:H}=Q,{visible:V,show:k,close:p}=pe({defaultVisible:B});P.useEffect(()=>{var T,j,K,I;if(S===!1&&d){let w=(j=(T=i==null?void 0:i.params)==null?void 0:T[d])==null?void 0:j.open;if(typeof w=="boolean"?w&&k():typeof w=="string"&&w==="true"&&k(),l){let G=(I=(K=i==null?void 0:i.params)==null?void 0:K[d])==null?void 0:I.id;G&&(e==null||e(G))}h(!0)}},[d,i,l,e]),P.useEffect(()=>{var T;S===!0&&(V&&d?n({query:{[d]:{...(T=i==null?void 0:i.params)==null?void 0:T[d],open:!0,...l&&s&&{id:s}}},options:{keepQuery:!0},type:"replace"}):d&&!V&&n({query:{[d]:void 0},options:{keepQuery:!0},type:"replace"}))},[s,V,k,d,l]);let D=F(async T=>{await r(T),M&&p(),W&&$()},"submit"),{warnWhen:O,setWarnWhen:X}=ye(),Z=J(()=>{var T;if(u.status==="success"&&((T=a==null?void 0:a.autoSave)!=null&&T.invalidateOnClose)&&R({id:s,invalidates:a.invalidates||["list","many","detail"],dataProviderName:a.dataProviderName,resource:y}),O)if(window.confirm(U("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))X(!1);else return;e==null||e(void 0),p()},[O,u.status]),_=J(T=>{typeof T<"u"&&(e==null||e(T)),(!(x==="edit"||x==="clone")||(typeof T<"u"||typeof s<"u"))&&k()},[s]),q=U(`${y}.titles.${f}`,void 0,`${E(`${f} ${((A=o==null?void 0:o.meta)==null?void 0:A.label)??((N=o==null?void 0:o.options)==null?void 0:N.label)??(o==null?void 0:o.label)??y}`,"singular")}`);return{modal:{submit:D,close:Z,show:_,visible:V,title:q},...Q,saveButtonProps:{...v,onClick:T=>H(D)(T)}}},"useModalForm");export{C as useForm,xe as useModalForm,le as useStepsForm};
//# sourceMappingURL=index.mjs.map